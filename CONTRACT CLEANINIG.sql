-- NEXT WE GO TO THE CONTRACT AND 3 THING WE WILL DO HERE WHICH IS 
--GET SEPERATE COLUMN FOR STARTCONTRACT, ENDCONTRACT AND STATUS

SELECT Contract FROM FIFA

-- VIEWING ON LOAN CONTRACTS
SELECT CONTRACT
FROM FIFA
WHERE CONTRACT LIKE '%ON LOAN%'

-- VIEWING ON FREE CONTRACT

SELECT CONTRACT
FROM FIFA
WHERE CONTRACT LIKE '%FREE'

-- VIEWING ON %~% CONTRACT

SELECT CONTRACT
FROM FIFA
WHERE CONTRACT LIKE '%~%'

UPDATE FIFA
SET Contract = REPLACE(CONTRACT,'~','-')

--STARTYEAR SYNTAX
SELECT CONTRACT, CASE
					WHEN CONTRACT LIKE '%LOAN%' THEN 'ON LOAN'
					WHEN CONTRACT LIKE '%FREE%' THEN 'FREE'
					ELSE CAST(YEAR( CAST(LEFT(CONTRACT,4) + '-01-01' AS date)) AS  VARCHAR(20))
					END
FROM FIFA
WHERE CONTRACT LIKE '%LOAN%' OR CONTRACT LIKE '%FREE%' OR CONTRACT LIKE '%~%'

-- ENDYEAR SYNTAX
SELECT CONTRACT, CASE
					WHEN CONTRACT LIKE '%LOAN%' THEN 'ON LOAN'
					WHEN CONTRACT LIKE '%FREE%' THEN 'FREE'
					ELSE CAST(YEAR( CAST(RIGHT(CONTRACT,4) + '-01-01' AS date)) AS  VARCHAR(20))
					END
FROM FIFA
WHERE CONTRACT LIKE '%LOAN%' OR CONTRACT LIKE '%FREE%' OR CONTRACT LIKE '%~%'

--ADD THE COLUMN AND UPDATE THE TABLE
ALTER TABLE FIFA
ADD ContractStartYear varchar (20),
ContractEndYear varchar(20)

UPDATE FIFA
SET ContractStartYear =
			CASE
					WHEN CONTRACT LIKE '%LOAN%' THEN 'ON LOAN'
					WHEN CONTRACT LIKE '%FREE%' THEN 'FREE'
					ELSE CAST(YEAR( CAST(LEFT(CONTRACT,4) + '-01-01' AS date)) AS  VARCHAR(20))
					END,
	ContractENDYear = 
			CASE
					WHEN CONTRACT LIKE '%LOAN%' THEN 'ON LOAN'
					WHEN CONTRACT LIKE '%FREE%' THEN 'FREE'
					ELSE CAST(YEAR( CAST(RIGHT(CONTRACT,4) + '-01-01' AS date)) AS  VARCHAR(20))
					END
FROM FIFA
WHERE CONTRACT LIKE '%LOAN%' OR CONTRACT LIKE '%FREE%' OR CONTRACT LIKE '%~%'

--NEXT WE CREATE THE STATUS SYNTAX

SELECT CONTRACT, CASE
					WHEN CONTRACT LIKE '%~%' THEN 'ACTIVE CONTRACT'
					WHEN CONTRACT LIKE '%LOAN%' THEN 'ON LOAN'
					WHEN CONTRACT LIKE 'FREE' THEN 'FREE'
					ELSE CONTRACT
					END
FROM FIFA

--CREATE THE STATUS COLUMN AND UPDATE THE TABLE

ALTER TABLE FIFA
ADD ContractStatus varchar (20)

update FIFA
set ContractStatus = CASE
					WHEN CONTRACT LIKE '%~%' THEN 'ACTIVE CONTRACT'
					WHEN CONTRACT LIKE '%LOAN%' THEN 'ON LOAN'
					WHEN CONTRACT LIKE 'FREE' THEN 'FREE'
					ELSE Null
					END
select ContractStatus from FIFA

--check for duplicates in the ID

SELECT ID, COUNT(*) AS NUM_DUPLICATE
FROM FIFA
GROUP BY ID
HAVING COUNT(*)  >1